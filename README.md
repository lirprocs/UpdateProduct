# UpdateProduct

HTTPS-сервер для раздачи обновлений продуктов с автоматической генерацией SSL-сертификатов.

## Описание

UpdateProduct - это простой и безопасный HTTPS-сервер, разработанный на Go, предназначенный для раздачи файлов обновлений через защищенное TLS-соединение. Сервер автоматически генерирует самоподписанные сертификаты при первом запуске и использует только современный протокол TLS 1.3 для обеспечения максимальной безопасности.

## Возможности

- **Автоматическая генерация SSL-сертификатов** - создает корневой CA и wildcard сертификат при первом запуске
- **TLS 1.3 только** - использует исключительно TLS 1.3 для максимальной безопасности
- **Простой файловый сервер** - раздает файлы из директории `updates/`
- **Логирование соединений** - отслеживает все TLS-соединения с информацией о версии и шифровании
- **IPv6 поддержка** - сервер работает на IPv6 адресе `[::1]`

## Требования

- Права администратора (для прослушивания порта 443 на Windows)

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/lirprocs/UpdateProduct.git
cd UpdateProduct
```

2. Соберите проект:
```bash
go build -o UpdateProduct.exe
```

3. Добавление манифеста: 
```bash
mt.exe -manifest UpdateProduct.exe.manifest -outputresource:UpdateProduct.exe;#1
```

4. Установите `ca-root.crt` в хранилище доверенных корневых сертификатов

## Использование

1. Запустите сервер с правами администратора:
```bash
# Windows
UpdateProduct.exe

# Linux/macOS
sudo ./UpdateProduct
```

2. Поместите файлы обновлений в директорию `updates/`:
   - Сервер создаст эту директорию автоматически при запуске
   - После размещения файлов нажмите Enter для продолжения

3. Доступ к файлам:
   - Сервер будет доступен по адресу: `https://[::1]:443/updates/`
   - Или через localhost: `https://localhost:443/updates/`

## Структура проекта

```
UpdateProduct/
├── main.go                 # Основной файл сервера
├── certgen.go             # Генератор SSL-сертификатов
├── go.mod                 # Файл зависимостей Go
├── .gitignore            # Игнорируемые файлы
├── UpdateProduct.exe.manifest  # Манифест для Windows (права администратора)
├── certs/                # Директория с сертификатами (генерируется автоматически)
├── keys/                 # Директория с ключами (генерируется автоматически)
└── updates/              # Директория с файлами для раздачи (создается автоматически)
```

## Генерация сертификатов

При первом запуске сервер автоматически генерирует:

1. **Корневой CA сертификат** (`ca-root.crt` и `ca-root.key`)
   - Срок действия: 10 лет
   - Размер ключа: 4096 бит
   - Организация: BadSSL Test CA

2. **Wildcard сертификат** (`wildcard.crt` и `wildcard.key`)
   - Срок действия: 2 года
   - Размер ключа: 2048 бит
   - Поддерживаемые домены:
     - `localhost`
     - `*.badssl.test`
     - `badssl.test`
     - `self-signed.badssl.test`
     - `expired.badssl.test`
     - `mixed.badssl.test`
     - `rc4.badssl.test`
     - `hsts.badssl.test`
   - Поддерживаемые IP-адреса:
     - `127.0.0.1`
     - `::1` (IPv6 localhost)

## Настройка TLS

Сервер настроен на использование только TLS 1.3 со следующими параметрами:

- **Минимальная версия TLS**: 1.3
- **Максимальная версия TLS**: 1.3
- **Предпочтительные кривые**: X25519, CurveP256

## Безопасность

Для использования в браузере или клиентских приложениях:
1. Установите `ca-root.crt` в хранилище доверенных корневых сертификатов
2. Или добавьте исключение для самоподписанного сертификата в настройках безопасности

## Логирование

Сервер логирует следующую информацию:
- Запуск сервера и доступные URL
- Информацию о каждом TLS-соединении:
  - Версия TLS протокола
  - Используемый cipher suite
  - IP-адрес клиента

Пример лога:
```
TLS connection: version=TLS 1.3, cipher=TLS_AES_128_GCM_SHA256, от [::1]:54321
```

## Разработка

### Зависимости

Проект использует только стандартную библиотеку Go, внешние зависимости не требуются.

### Сборка

```bash
# Сборка для текущей платформы
go build -o UpdateProduct

# Сборка для Windows
GOOS=windows GOARCH=amd64 go build -o UpdateProduct.exe

# Сборка для Linux
GOOS=linux GOARCH=amd64 go build -o UpdateProduct

# Сборка для macOS
GOOS=darwin GOARCH=amd64 go build -o UpdateProduct
```

## Автор

**Lirprocs**
- GitHub: [@lirprocs](https://github.com/lirprocs)

## Лицензия

Проект распространяется свободно. Используйте на свой страх и риск.

## Вклад в проект

Предложения по улучшению и pull request'ы приветствуются!

## Известные ограничения

- Сервер работает только на порту 443 (настраивается в коде)
- Поддерживает только TLS 1.3
- Сертификаты самоподписанные (для продакшн используйте CA)
- Файловый сервер не поддерживает индексацию директорий
